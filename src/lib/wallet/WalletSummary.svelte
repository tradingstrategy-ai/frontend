<script lang="ts">
	import type { ConnectedWallet } from '$lib/wallet/client';
	import { switchNetwork } from '@wagmi/core';
	import { getExplorerUrl } from '$lib/wallet/utils';
	import { type Chain, getChainSlug, getChainName } from '$lib/helpers/chain';
	import { getLogoUrl } from '$lib/helpers/assets';
	import { AlertItem, AlertList, CryptoAddressWidget, EntitySymbol } from '$lib/components';
	import WalletWidget from '$lib/components/WalletWidget.svelte';

	export let wallet: ConnectedWallet;
	export let requestedChainId: MaybeNumber;
	export let chains: Chain[];

	$: ({ name, address, chain } = wallet);
	$: walletLogoUrl = getLogoUrl(name.toLowerCase());
</script>

<table class="wallet-summary responsive">
	<tbody>
		<tr>
			<td>Wallet</td>
			<td class="wallet-data">
				{#if walletLogoUrl}
					<img alt={name} src={walletLogoUrl} />
				{/if}
				{name}
				<span class="status">
					<div class="dot" />
					Connected
				</span>
			</td>
		</tr>
		<tr>
			<td>Account</td>
			<td>
				<WalletWidget {address} {chain} size="sm" />
			</td>
		</tr>
		<tr>
			<td>Network</td>
			<td>
				{#if requestedChainId && requestedChainId !== chain.id}
					<!-- svelte-ignore a11y-click-events-have-key-events -->
					<div class="wrong-network-alert" on:click={() => switchNetwork({ chainId: requestedChainId })}>
						<AlertList size="xs" status="error">
							<AlertItem>Wrong network! Please connect to {getChainName(chains, requestedChainId)}</AlertItem>
						</AlertList>
					</div>
				{:else}
					<EntitySymbol type="blockchain" label={chain.name} slug={getChainSlug(chains, chain.id)} />
				{/if}
			</td>
		</tr>
	</tbody>
</table>

<style lang="postcss">
	.wallet-summary {
		margin: 0;

		/* FIXME: remove `!important` */
		@media (--viewport-sm-up) {
			--table-font: var(--f-ui-lg-medium) !important;
		}

		/* FIXME: remove `!important` (check 527 < viewport < 511) */
		& tr {
			grid-template-columns: repeat(auto-fit, minmax(max(25%, 14rem), 1fr)) !important;
		}

		& td {
			padding: var(--space-xs) var(--space-ml);
			align-content: center;

			&:first-child {
				font: var(--f-ui-md-medium);
			}
		}
	}

	.wallet-data {
		align-items: center;
		display: flex;
		gap: var(--space-sm);

		@media (--viewport-sm-down) {
			font: var(--f-ui-sm-medium);
		}

		& img {
			width: 2rem;

			@media (--viewport-sm-down) {
				width: 1.75rem;
			}
		}
	}

	.status {
		align-items: center;
		background: hsla(var(--hsl-success), 0.2);
		border-radius: var(--space-md);
		color: hsla(var(--hsl-success));
		display: flex;
		font: var(--f-ui-sm-medium);
		gap: var(--space-ss);
		margin-left: var(--space-sm);
		padding: var(--space-xs) var(--space-sl);

		& .dot {
			animation: pulse-opacity 1.5s ease-out infinite;
			background: hsla(var(--hsl-success));
			border-radius: 100%;
			height: 0.625rem;
			width: 0.625rem;
		}
	}

	.wrong-network-alert {
		display: inline-flex;
		word-break: normal;
		cursor: pointer;
	}

	.address-container {
		display: flex;
	}
</style>
